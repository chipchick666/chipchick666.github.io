<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoeStation | 探索放松的次元</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'float-slow': 'float 6s ease-in-out infinite',
                        'blob-move': 'move 20s infinite alternate',
                        // spin-slow 动画定义保留，以防用户后续想用于其他元素
                        'spin-slow': 'spin 10s linear infinite', 
                        'pop-in': 'modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        move: {
                            '0%, 100%': { transform: 'translate(0, 0) scale(1)' },
                            '50%': { transform: 'translate(20px, -20px) scale(1.1)' }
                        },
                        float: {
                            '0%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                            '100%': { transform: 'translateY(0px)' }
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', 'box-shadow': '0 4px 6px -1px rgba(0, 0, 0, 0.1)' },
                            '50%': { transform: 'scale(1.02)', 'box-shadow': '0 10px 15px -3px rgba(236, 72, 153, 0.3)' }
                        },
                        modalPop: {
                            '0%': { opacity: 0, transform: 'scale(0.8)' },
                            '100%': { opacity: 1, transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;500;700&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- 全局设置与拟态效果 --- */
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-image: url("冥想引导.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            color: #4a5568;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            z-index: -2;
        }

        /* 动态背景泡泡 */
        .blob {
            position: absolute;
            filter: blur(50px);
            z-index: -1;
            opacity: 0.6;
            mix-blend-mode: multiply;
        }

        /* 玻璃卡片基类 */
        .moe-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .moe-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: #F472B6;
            box-shadow: 0 25px 50px -12px rgba(244, 114, 182, 0.6);
        }

        .moe-card img {
            transition: transform 0.5s ease;
        }

        .moe-card:hover img {
            transform: scale(1.05);
        }

        /* 标签筛选器激活态呼吸动画 */
        .filter-btn.active {
            animation: breathe 3s infinite ease-in-out;
            background-color: white !important;
            color: #db2777 !important;
            border-color: #db2777 !important;
            box-shadow: 0 4px 15px rgba(219, 39, 119, 0.3);
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #F472B6, #A78BFA);
            border-radius: 10px;
        }

        /* 卡片淡入动画（修复卡片不显示的问题） */
        @keyframes fadeInPop {
            from { opacity: 0; transform: translateY(10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card-fade-in {
            animation: fadeInPop 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            opacity: 0;
        }

        /* 播放器内音频控件美化 (可选，兼容性一般，但可以提升视觉一致性) */
        #player-container audio {
            /* 尝试调整原生控件的宽度和边距 */
            width: 100%;
            max-width: 400px;
            margin: 20px 0;
        }
        
        /* 针对音乐播放器模态框的定制样式 */
        #player-modal .bg-music-dark {
            /* 统一深色背景，模仿 Apple Music */
            background-color: #121212; 
        }
    </style>
</head>

<body class="antialiased selection:bg-pink-200 selection:text-pink-900">

    <div class="blob bg-purple-300 w-96 h-96 rounded-full top-10 left-10 animate-blob-move"></div>
    <div class="blob bg-yellow-200 w-80 h-80 rounded-full top-1/4 right-5 animate-blob-move animation-delay-2000"></div>
    <div class="blob bg-pink-300 w-72 h-72 rounded-full bottom-10 left-1/3 animate-blob-move animation-delay-4000"></div>

    <div class="container mx-auto px-4 py-10 relative z-10 max-w-7xl">

        <header class="text-center mb-16 relative">
            <div class="inline-block animate-float-slow">
                <h1
                    class="text-6xl md:text-8xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-600 to-indigo-700 mb-4 tracking-tighter"
                    style="line-height: 1.1; text-shadow: 0 4px 10px rgba(0,0,0,0.15);">
                    Moe Station
                </h1>
            </div>
            <p class="text-slate-700 text-xl font-medium tracking-wider mt-3 text-shadow-sm">
                放松一下吧，进入您的专属次元 ✨
            </p>
        </header>

        <div class="flex flex-wrap justify-center gap-3 mb-12">
            <button onclick="setCategory('all')" id="btn-all"
                class="filter-btn active px-6 py-2 rounded-full border-2 border-pink-500 bg-white text-pink-600 font-bold transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm md:text-base">
                <i data-lucide="sparkles" class="w-4 h-4"></i> 全部次元
            </button>
            <button onclick="setCategory('video')" id="btn-video"
                class="filter-btn px-6 py-2 rounded-full border-2 border-transparent hover:border-blue-400 bg-white/70 text-slate-600 font-bold transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2 text-sm md:text-base">
                <i data-lucide="tv" class="w-4 h-4"></i> 追番影视
            </button>
            <button onclick="setCategory('music')" id="btn-music"
                class="filter-btn px-6 py-2 rounded-full border-2 border-transparent hover:border-green-400 bg-white/70 text-slate-600 font-bold transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2 text-sm md:text-base">
                <i data-lucide="headphones" class="w-4 h-4"></i> 听歌放松
            </button>
            <button onclick="setCategory('game')" id="btn-game"
                class="filter-btn px-6 py-2 rounded-full border-2 border-transparent hover:border-purple-400 bg-white/70 text-slate-600 font-bold transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2 text-sm md:text-base">
                <i data-lucide="gamepad-2" class="w-4 h-4"></i> 摸鱼游戏
            </button>
        </div>

        <div id="content-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 px-2">
            </div>

        <div class="flex justify-center items-center mt-16 gap-4">
            <button onclick="changePage(-1)"
                class="w-12 h-12 rounded-full bg-white shadow-xl flex items-center justify-center text-pink-500 hover:bg-pink-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                id="prev-btn">
                <i data-lucide="chevron-left" class="w-6 h-6"></i>
            </button>
            <span id="page-indicator"
                class="font-extrabold text-lg text-slate-700 bg-white/80 px-6 py-2 rounded-full backdrop-blur-sm shadow-inner min-w-[80px] text-center">
                1 / 1
            </span>
            <button onclick="changePage(1)"
                class="w-12 h-12 rounded-full bg-white shadow-xl flex items-center justify-center text-pink-500 hover:bg-pink-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                id="next-btn">
                <i data-lucide="chevron-right" class="w-6 h-6"></i>
            </button>
        </div>

    </div>

    <div id="detail-modal"
        class="fixed inset-0 z-50 flex items-center justify-center hidden p-4 transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-md transition-opacity" onclick="closeDetail()"></div>

        <div
            class="relative moe-card rounded-3xl shadow-2xl w-full max-w-4xl modal-enter flex flex-col transform-none"
            style="max-height: 95vh;">

            <div
                class="flex justify-between items-center p-4 md:p-6 border-b border-gray-100 bg-gradient-to-r from-pink-50 to-purple-50 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <span id="detail-icon"
                        class="p-2 bg-white rounded-xl shadow-lg text-pink-500 border border-pink-200"></span>
                    <h3 id="detail-title" class="text-xl md:text-3xl font-bold text-slate-700 truncate">标题详情</h3>
                </div>
                <button onclick="closeDetail()"
                    class="p-2 rounded-full hover:bg-red-100 text-slate-400 hover:text-red-500 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="p-6 md:p-8 overflow-y-auto flex-1">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-1/3 flex-shrink-0">
                        <img id="detail-cover" src="" alt="封面"
                            class="w-full h-auto rounded-2xl shadow-xl mb-4 object-cover border-2 border-pink-100">
                        <p class="text-sm font-semibold text-slate-600">类型: <span id="detail-type"
                                class="font-bold text-pink-500 ml-1"></span></p>
                    </div>

                    <div class="md:w-2/3">
                        <h4 class="text-2xl font-bold text-slate-700 mb-3 border-b-2 border-pink-100 pb-2">简介</h4>
                        <p id="detail-desc" class="text-slate-600 mb-6 leading-relaxed text-base"></p>

                        <div id="detail-action-area">
                            <h4 id="action-header"
                                class="text-2xl font-bold text-slate-700 mb-3 border-b-2 border-pink-100 pb-2"></h4>

                            <button id="single-play-btn" onclick="startPlayback(null)"
                                class="w-full py-4 rounded-xl text-white font-extrabold shadow-lg flex items-center justify-center gap-2 hidden
                                bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-[1.01]">
                                <i data-lucide="play-circle" class="w-5 h-5"></i> 立即开始
                            </button>

                            <div id="episodes-list"
                                class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 max-h-60 overflow-y-auto p-2 border border-gray-200 rounded-xl bg-white/70">
                                </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <div id="player-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden p-2 md:p-8">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closePlayer()"></div>

        <div
            class="relative bg-white rounded-xl md:rounded-3xl shadow-2xl w-full max-w-5xl overflow-hidden modal-enter flex flex-col"
            style="max-height: 95vh;">

            <div
                class="flex justify-between items-center p-3 md:p-4 border-b border-gray-100 bg-gradient-to-r from-pink-50 to-purple-50 flex-shrink-0">
                <div class="flex items-center gap-2">
                    <span id="modal-icon"
                        class="p-2 bg-white rounded-full shadow-sm text-pink-500 border border-pink-200"></span>
                    <h3 id="modal-title" class="text-base md:text-xl font-bold text-slate-700 truncate">标题</h3>
                </div>
                <button onclick="closePlayer()"
                    class="p-2 rounded-full hover:bg-red-100 text-slate-400 hover:text-red-500 transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div id="player-container"
                class="flex-1 bg-black flex items-center justify-center relative overflow-hidden w-full"
                style="min-height: 200px;">
                <div class="text-white animate-pulse">加载中...</div>
            </div>

            <div class="p-3 md:p-4 bg-white text-sm text-slate-500 flex-shrink-0">
                <p id="modal-desc" class="truncate">这里是描述信息...</p>
            </div>
        </div>
    </div>

    <script>
        /**
         * ==========================================
         * 数据库结构
         * ==========================================
         */
        const database = [
            {
                id: 1,
                type: 'video',
                title: '星之子 - 动漫全集 (多集示例)',
                desc: '木叶飞舞之处，火亦生生不息。这是一部关于勇气、友谊和成长的热血动漫，每一集都充满了惊喜和感动。',
                cover: 'https://images.unsplash.com/photo-1578632767115-351597cf2477?q=80&w=600&auto=format&fit=crop',
                episodes: [ // 剧集列表
                    { title: '第1话：启程之星', src: 'https://acgfta.com/play/2916-2-1.html' },
                    { title: '第2话：命运交织', src: 'https://www.w3schools.com/html/mov_bbb.mp4' },
                    { title: '第3话：伙伴誓约', src: 'https://www.w3schools.com/html/mov_bbb.mp4' },
                    { title: '第4话：试炼之塔', src: 'https://acgfta.com/play/2916-2-1.html' },
                    { title: '第5话：觉醒之力', src: 'https://www.w3schools.com/html/mov_bbb.mp4' },
                ]
            },
            {
                id: 2,
                type: 'game',
                title: '地铁跑酷',
                desc: '经典的跑酷游戏，看看你能跑多远吧！在繁忙的地铁轨道上奔跑、跳跃、躲避，挑战你的极限反应能力。',
                cover: 'https://images.unsplash.com/photo-1551103782-8ab07afd45c1?q=80&w=600&auto=format&fit=crop',
                src: 'https://subway-surfers.gg/zh-CN/' // 外部游戏链接
            },
            {
                id: 3,
                type: 'music',
                title: '愿与愁',
                desc: '漫天风雪我陪你颤抖，我们别回头。一首充满力量与柔情的歌曲，适合在夜晚静静聆听。',
                cover: 'https://images.unsplash.com/photo-1517457210348-2cb739db86a2?q=80&w=600&auto=format&fit=crop',
                src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3' // 示例音频
            },
            {
                id: 4,
                type: 'video',
                title: '宇宙的奥秘 (单集视频)',
                desc: '探索浩瀚的星空，了解宇宙的起源与未来。一部高质量的科普纪录片，带您领略宇宙的壮丽。',
                cover: 'https://images.unsplash.com/photo-1543722530-d2c320140670?q=80&w=600&auto=format&fit=crop',
                src: 'https://www.w3schools.com/html/mov_bbb.mp4' // 单集视频源
            },
            {
                id: 5,
                type: 'music',
                title: '治愈系钢琴曲',
                desc: '在柔和的琴声中放松身心，忘却烦恼。纯净的钢琴旋律，是冥想和学习的最佳伴侣。',
                cover: 'https://images.unsplash.com/photo-1510915228308-f1c640e0c0ae?q=80&w=600&auto=format&fit=crop',
                src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3'
            },
            {
                id: 6,
                type: 'game',
                title: '消消乐大作战',
                desc: '简单有趣的益智游戏，让你停不下来！通过消除方块来获得高分，挑战你的观察力和策略。',
                cover: 'https://images.unsplash.com/photo-1554907983-5006b976249a?q=80&w=600&auto=format&fit=crop',
                src: 'https://g.4399.com/html/436/748/20002130.html' // 外部游戏链接
            }
        ];

        // 状态管理 (保持不变)
        let state = {
            category: 'all',
            currentPage: 1,
            itemsPerPage: 4, 
            currentDetailId: null
        };

        // 常量映射 (保持不变)
        const icons = {
            video: 'clapperboard',
            music: 'music',
            game: 'gamepad-2',
            all: 'sparkles'
        };

        const typeColors = {
            video: 'bg-blue-100 text-blue-600',
            music: 'bg-green-100 text-green-600',
            game: 'bg-purple-100 text-purple-600'
        };

        const typeNames = {
            video: '影视',
            music: '音乐',
            game: '游戏'
        };

        // 初始化、setCategory, getFilteredData, changePage, renderCards, openDetail, closeDetail 保持不变

        document.addEventListener('DOMContentLoaded', () => {
            renderCards();
            lucide.createIcons();
        });

        function setCategory(cat) {
            state.category = cat;
            state.currentPage = 1;

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-white', 'text-pink-600', 'border-pink-500');
                btn.classList.add('bg-white/70', 'text-slate-600');
            });

            const activeBtn = document.getElementById(`btn-${cat}`);
            activeBtn.classList.add('active', 'bg-white', 'text-pink-600', 'border-pink-500');
            activeBtn.classList.remove('bg-white/70', 'text-slate-600');

            renderCards();
        }

        function getFilteredData() {
            if (state.category === 'all') return database;
            return database.filter(item => item.type === state.category);
        }

        function changePage(delta) {
            const filtered = getFilteredData();
            const maxPage = Math.ceil(filtered.length / state.itemsPerPage);
            const newPage = state.currentPage + delta;

            if (newPage >= 1 && newPage <= maxPage) {
                state.currentPage = newPage;
                renderCards();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function renderCards() {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';

            const filtered = getFilteredData();
            const totalItems = filtered.length;
            const totalPages = Math.ceil(totalItems / state.itemsPerPage) || 1;

            document.getElementById('page-indicator').innerText = `${state.currentPage} / ${totalPages}`;
            document.getElementById('prev-btn').disabled = state.currentPage === 1;
            document.getElementById('next-btn').disabled = state.currentPage === totalPages;

            const start = (state.currentPage - 1) * state.itemsPerPage;
            const end = start + state.itemsPerPage;
            const pageItems = filtered.slice(start, end);

            if (pageItems.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center text-slate-400 py-20 text-lg">这里空空如也呢... (｡•́︿•̀｡)</div>`;
                return;
            }

            pageItems.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'moe-card rounded-3xl overflow-hidden flex flex-col h-full relative group card-fade-in';
                card.style.animationDelay = `${index * 0.1}s`;
                card.onclick = () => openDetail(item.id);

                let btnText, btnIcon;
                if (item.type === 'video') {
                    btnText = item.episodes ? `共 ${item.episodes.length} 集` : '单集视频';
                    btnIcon = 'file-text';
                } else if (item.type === 'game') {
                    btnText = '开始游戏';
                    btnIcon = 'play';
                } else if (item.type === 'music') {
                    btnText = '立即播放';
                    btnIcon = 'play-circle';
                }

                card.innerHTML = `
                    <div class="relative h-48 overflow-hidden">
                        <img src="${item.cover}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-500" onerror="this.src='https://placehold.co/600x400/A78BFA/ffffff?text=${typeNames[item.type]}'">
                        <div class="absolute top-4 left-4 px-3 py-1 rounded-full text-xs font-bold ${typeColors[item.type]} shadow-md">
                            ${typeNames[item.type]}
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    </div>
                    
                    <div class="p-5 flex-1 flex flex-col">
                        <h3 class="text-xl font-bold text-slate-700 mb-2 group-hover:text-pink-600 transition-colors line-clamp-1">${item.title}</h3>
                        <p class="text-slate-500 text-sm mb-4 flex-1 line-clamp-2 leading-relaxed">${item.desc}</p>
                        
                        <div class="w-full py-3 rounded-xl text-white font-bold shadow-lg flex items-center justify-center gap-2 cursor-pointer
                            bg-gradient-to-r from-pink-500 to-purple-500 transition-all duration-300 transform group-hover:scale-[1.03]">
                            <i data-lucide="${btnIcon}" class="w-4 h-4"></i> ${btnText}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            lucide.createIcons();
        }

        function openDetail(id) {
            const item = database.find(i => i.id === id);
            if (!item) return;

            state.currentDetailId = id;

            const modal = document.getElementById('detail-modal');
            const elements = {
                title: document.getElementById('detail-title'),
                desc: document.getElementById('detail-desc'),
                cover: document.getElementById('detail-cover'),
                type: document.getElementById('detail-type'),
                iconContainer: document.getElementById('detail-icon'),
                episodesList: document.getElementById('episodes-list'),
                singlePlayBtn: document.getElementById('single-play-btn'),
                actionHeader: document.getElementById('action-header')
            };

            elements.title.innerText = item.title;
            elements.desc.innerText = item.desc;
            elements.cover.src = item.cover;
            elements.type.innerText = typeNames[item.type];
            elements.iconContainer.innerHTML = `<i data-lucide="${icons[item.type]}" class="w-6 h-6"></i>`;
            
            elements.episodesList.innerHTML = '';
            elements.episodesList.classList.add('hidden');
            elements.singlePlayBtn.classList.add('hidden'); 

            if (item.type === 'video') {
                const isMultiEpisode = item.episodes && item.episodes.length > 0;

                if (isMultiEpisode) {
                    elements.actionHeader.innerText = '剧集列表';
                    elements.episodesList.classList.remove('hidden');
                    item.episodes.forEach((episode, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'btn-episode px-3 py-2 rounded-lg font-medium truncate shadow-sm transition-all duration-200 border border-gray-300 text-gray-700 hover:bg-pink-100 hover:border-pink-500 hover:text-pink-600';
                        btn.onclick = () => startPlayback(item.id, index);
                        btn.innerText = episode.title;
                        elements.episodesList.appendChild(btn);
                    });
                } else if (item.src) {
                    elements.actionHeader.innerText = '立即观看';
                    elements.singlePlayBtn.innerText = '立即观看';
                    elements.singlePlayBtn.onclick = () => startPlayback(item.id, null);
                    elements.singlePlayBtn.classList.remove('hidden');
                } else {
                    elements.actionHeader.innerText = '播放信息';
                    elements.episodesList.classList.remove('hidden');
                    elements.episodesList.innerHTML = `<p class="text-slate-400 text-sm p-4 col-span-full">暂无播放源信息。</p>`;
                }
            } else {
                elements.actionHeader.innerText = (item.type === 'music' ? '播放音乐' : '开始游戏');
                elements.singlePlayBtn.innerText = (item.type === 'music' ? '立即播放' : '开始游戏');
                elements.singlePlayBtn.onclick = () => startPlayback(item.id, null);
                elements.singlePlayBtn.classList.remove('hidden');
            }

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeDetail() {
            const modal = document.getElementById('detail-modal');
            state.currentDetailId = null;
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }


        // 开始播放 (核心播放逻辑 - 音乐部分已更新)
        function startPlayback(id, index = null) {
            const itemId = id !== null ? id : state.currentDetailId;
            const item = database.find(i => i.id === itemId);
            if (!item) return;

            let mediaSrc;
            let mediaTitle = item.title;

            if (item.type === 'video' && item.episodes && index !== null && item.episodes[index]) {
                const episode = item.episodes[index];
                mediaSrc = episode.src;
                mediaTitle = `${item.title} - ${episode.title}`;
            } else {
                mediaSrc = item.src;
            }

            if (!mediaSrc) {
                alert(`无法找到 "${mediaTitle}" 的播放源信息。`);
                return;
            }
            
            closeDetail(); // 播放前关闭详情页

            const modal = document.getElementById('player-modal');
            const container = document.getElementById('player-container');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const iconContainer = document.getElementById('modal-icon');

            title.innerText = mediaTitle;
            desc.innerText = item.desc;
            iconContainer.innerHTML = `<i data-lucide="${icons[item.type]}" class="w-5 h-5"></i>`;

            container.innerHTML = ''; // 清理旧内容
            let contentHtml = '';

            container.style.aspectRatio = '16/9'; // 默认 16:9

            if (item.type === 'game') {
                container.style.aspectRatio = '4/3'; 
                contentHtml = `<iframe src="${mediaSrc}" class="w-full h-full border-0" allowfullscreen sandbox="allow-scripts allow-same-origin allow-popups"></iframe>`;
            } else if (item.type === 'video') {
                if (mediaSrc.endsWith('.mp4') || mediaSrc.endsWith('.webm')) {
                    contentHtml = `<video src="${mediaSrc}" controls autoplay class="w-full h-full bg-black"></video>`;
                } else {
                    contentHtml = `<iframe src="${mediaSrc}" class="w-full h-full border-0" allowfullscreen allow="autoplay"></iframe>`;
                }
            } else if (item.type === 'music') {
                // 【核心修改】Apple Music 风格的播放器界面
                container.style.aspectRatio = 'auto'; 
                contentHtml = `
                    <div class="flex flex-col items-center justify-center w-full h-full bg-zinc-900 text-white relative p-4 md:p-12 overflow-hidden bg-music-dark">
                        <img src="${item.cover}" class="absolute inset-0 w-full h-full object-cover opacity-5 blur-2xl pointer-events-none">
                        
                        <div class="relative z-10 flex flex-col items-center gap-6 w-full max-w-lg">
                            <img src="${item.cover}" 
                                alt="${item.title} cover"
                                class="w-full max-w-xs md:max-w-sm aspect-square rounded-xl shadow-2xl object-cover transform hover:scale-[1.01] transition-transform duration-300 border border-white/10">
                            
                            <div class="text-center w-full mt-4">
                                <h4 class="text-2xl md:text-3xl font-bold text-white mb-1 line-clamp-1">${item.title}</h4>
                                <p class="text-sm text-zinc-400 line-clamp-2">${item.desc}</p>
                            </div>

                            <audio controls autoplay class="mt-6 w-full max-w-md">
                                <source src="${mediaSrc}" type="audio/mpeg">
                                您的浏览器不支持音频播放。
                            </audio>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = contentHtml;

            // 4. 显示播放器模态框
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        // 关闭播放器 (保持不变)
        function closePlayer() {
            const modal = document.getElementById('player-modal');
            const container = document.getElementById('player-container');

            modal.classList.add('hidden');
            container.innerHTML = ''; 
            container.style.aspectRatio = 'auto';
            document.body.style.overflow = 'auto'; 
        }

        // 监听 ESC 键关闭 (保持不变)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePlayer();
                closeDetail();
            }
        });

    </script>
</body>

</html>
